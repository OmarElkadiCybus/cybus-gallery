# ----------------------------------------------------------------------------#
# Commissioning File
# ----------------------------------------------------------------------------#
# Copyright: Cybus GmbH (2020)
# Contact: support@cybus.io
# ----------------------------------------------------------------------------#
# Source Interface Definition - Modbus TCP
# ----------------------------------------------------------------------------#

description: >
  Connect to Modbus TCP devices and read coils and registers.
  Example demonstrates reading boolean coils and 16-bit integer registers.

metadata:
  name: Modbus TCP Read Example
  provider: cybus
  homepage: https://www.cybus.io
  version: 1.0.0

parameters:
    IP_Address:
        type: string
        default: 192.168.10.30

    Port_Number:
        type: number
        default: 502

    initialReconnectDelay:
        type: integer
        default: 1000

    maxReconnectDelay:
        type: integer
        default: 30000

    factorReconnectDelay:
        type: integer
        default: 2

resources:
    modbusConnection:
        type: Cybus::Connection
        properties:
            protocol: Modbus
            targetState: connected
            connection:
                host: !ref IP_Address
                port: !ref Port_Number
                connectionStrategy:
                    initialDelay: !ref initialReconnectDelay
                    maxDelay: !ref maxReconnectDelay
                    incrementFactor: !ref factorReconnectDelay

    readCoil:
        type: Cybus::Endpoint
        properties:
            protocol: Modbus
            connection: !ref modbusConnection
            subscribe:
                fc: 1
                length: 2
                interval: 1000
                address: 3
                dataType: boolean

    readRegister:
      type: Cybus::Endpoint
      properties:
          protocol: Modbus
          connection: !ref modbusConnection
          subscribe:
              fc: 3
              length: 2
              interval: 1000
              address: 1
              dataType: int16BE